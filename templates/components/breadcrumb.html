{% load static %}
{% comment %}
Advanced Breadcrumb Navigation Component
Usage: {% include 'components/breadcrumb.html' with breadcrumbs=breadcrumb_list %}

Expected breadcrumbs format:
[
    {'name': 'Home', 'url': '/', 'icon': 'home'},
    {'name': 'Anime', 'url': '/anime/', 'icon': 'tv'},
    {'name': 'Current Page', 'url': '', 'active': True}
]
{% endcomment %}

{% if breadcrumbs %}
<!-- Breadcrumb Navigation with Schema.org markup -->
<nav aria-label="Breadcrumb" class="py-4 px-6 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm rounded-xl mb-6 border border-gray-200/20 dark:border-gray-700/20">
    <ol class="flex items-center space-x-2 text-sm" itemscope itemtype="https://schema.org/BreadcrumbList">
        {% for breadcrumb in breadcrumbs %}
        <li class="flex items-center" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            {% if not breadcrumb.active and breadcrumb.url %}
                <!-- Clickable breadcrumb -->
                <a href="{{ breadcrumb.url }}" 
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-gold-600 dark:hover:text-korteks-red transition-colors duration-200"
                   itemprop="item">
                    {% if breadcrumb.icon %}
                        {% if breadcrumb.icon == 'home' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        {% elif breadcrumb.icon == 'tv' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m4 0H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2z" />
                        </svg>
                        {% elif breadcrumb.icon == 'play' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V17M6 10h2m6 0h2m-3 4l3-3m-3 3l3 3" />
                        </svg>
                        {% elif breadcrumb.icon == 'search' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        {% elif breadcrumb.icon == 'calendar' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        {% elif breadcrumb.icon == 'star' %}
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                        </svg>
                        {% endif %}
                    {% endif %}
                    <span itemprop="name">{{ breadcrumb.name }}</span>
                    <meta itemprop="position" content="{{ forloop.counter }}" />
                </a>
            {% else %}
                <!-- Current/Active breadcrumb -->
                <span class="flex items-center font-medium text-gold-600 dark:text-korteks-red" 
                      itemprop="item">
                    {% if breadcrumb.icon %}
                        {% if breadcrumb.icon == 'home' %}
                        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        {% elif breadcrumb.icon == 'tv' %}
                        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M21 6H3a2 2 0 00-2 2v8a2 2 0 002 2h18a2 2 0 002-2V8a2 2 0 00-2-2zm-10 9H8v-2h3v2zm0-4H8V9h3v2zm3 4h-3v-2h3v2zm0-4h-3V9h3v2zm3 4h-3v-2h3v2zm0-4h-3V9h3v2z"/>
                        </svg>
                        {% elif breadcrumb.icon == 'play' %}
                        <svg class="w-4 h-4 mr-1.5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        {% endif %}
                    {% endif %}
                    <span itemprop="name">{{ breadcrumb.name }}</span>
                    <meta itemprop="position" content="{{ forloop.counter }}" />
                </span>
            {% endif %}
            
            <!-- Separator (except for last item) -->
            {% if not forloop.last %}
            <span class="mx-2 text-gray-400 dark:text-gray-500" aria-hidden="true">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                </svg>
            </span>
            {% endif %}
        </li>
        {% endfor %}
    </ol>
</nav>

<!-- Rich Breadcrumb Structured Data -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {% for breadcrumb in breadcrumbs %}
        {
            "@type": "ListItem",
            "position": {{ forloop.counter }},
            "name": "{{ breadcrumb.name|escapejs }}",
            {% if breadcrumb.url and not breadcrumb.active %}
            "item": "{{ request.scheme }}://{{ request.get_host }}{{ breadcrumb.url }}"
            {% else %}
            "item": "{{ request.build_absolute_uri }}"
            {% endif %}
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endif %}

<!-- Mobile-friendly breadcrumb for small screens -->
{% if breadcrumbs and breadcrumbs|length > 2 %}
<div class="md:hidden">
    <nav class="flex items-center space-x-2 text-sm px-4 py-2 bg-gray-50 dark:bg-gray-800 rounded-lg mb-4">
        <!-- Back button for mobile -->
        {% if breadcrumbs|length > 1 %}
            {% for breadcrumb in breadcrumbs reversed %}
                {% if forloop.counter0 == 1 %}
                <a href="{{ breadcrumb.url|default:'/' }}" 
                   class="flex items-center text-gray-600 dark:text-gray-300 hover:text-gold-600 dark:hover:text-korteks-red">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    <span class="sr-only">Back to {{ breadcrumb.name }}</span>
                </a>
                {% endif %}
            {% endfor %}
        {% endif %}
        
        <!-- Current page only on mobile -->
        {% with last_breadcrumb=breadcrumbs|last %}
        <span class="font-medium text-gray-900 dark:text-white truncate">
            {{ last_breadcrumb.name }}
        </span>
        {% endwith %}
    </nav>
</div>
{% endif %}